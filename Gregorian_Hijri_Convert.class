<?php
//Class to convert Gregorian date into Hijri date
class Gregorian_HijriConvert
{
	var $Day;
	var $Month;
	var $Year;


	function intPart($floatNum)
	{
		if ($floatNum< -0.0000001)
		{
			return ceil($floatNum-0.0000001);
		}
		return floor($floatNum+0.0000001);
	}

	function ConstractDayMonthYear($date,$format) // extract day, month, year out of the date based on the format.
	{
		$this->Day="";
		$this->Month="";
		$this->Year="";

		$format=strtoupper($format);
		$format_Ar= str_split($format);
		$srcDate_Ar=str_split($date);

		for ($i=0;$i<count($format_Ar);$i++)
		{

			switch($format_Ar[$i])
			{
				case "D":
					$this->Day.=$srcDate_Ar[$i];
					break;
				case "M":
					$this->Month.=$srcDate_Ar[$i];
					break;
				case "Y":
					$this->Year.=$srcDate_Ar[$i];
					break;
			}
		}

	}

	function GregorianToHijri($date,$format) // $date like 10122011, $format like DDMMYYYY, take date & check if its gregorian then convert to hijri date in format (DD-MM-YYYY);
	{
		$this->ConstractDayMonthYear($date,$format);
		$d=intval($this->Day);
		$m=intval($this->Month);
		$y=intval($this->Year);

		if ($y>1700)
		{
		if (($y>1582)||(($y==1582)&&($m>10))||(($y==1582)&&($m==10)&&($d>14)))
		{
			$jd=$this->intPart((1461*($y+4800+$this->intPart(($m-14)/12)))/4)+$this->intPart((367*($m-2-12*($this->intPart(($m-14)/12))))/12)-$this->intPart((3*($this->intPart(($y+4900+$this->intPart(($m-14)/12))/100)))/4)+$d-32075;
		}
		else
		{
			$jd = 367*$y-$this->intPart((7*($y+5001+$this->intPart(($m-9)/7)))/4)+$this->intPart((275*$m)/9)+$d+1729777;
		}

		$l=$jd-1948440+10632;
		$n=$this->intPart(($l-1)/10631);
		$l=$l-10631*$n+354;
		$j=($this->intPart((10985-$l)/5316))*($this->intPart((50*$l)/17719))+($this->intPart($l/5670))*($this->intPart((43*$l)/15238));
		$l=$l-($this->intPart((30-$j)/15))*($this->intPart((17719*$j)/50))-($this->intPart($j/16))*($this->intPart((15238*$j)/43))+29;
		$m=$this->intPart((24*$l)/709);
		$d=$l-$this->intPart((709*$m)/24);
		$y=30*$n+$j-30;

		if ($d<10)
			$d="0".$d;

		if ($m<10)
			$m="0".$m;

		return $d."-".$m."-".$y;
		}
		else
			return "";
	}
}
?>